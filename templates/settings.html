{% extends "base.html" %}
{% set active = "settings" %}
{% block title %}Readtube — Settings{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold tracking-tight text-ink mb-6">Settings</h1>

{% if saved %}
<div class="alert alert-success">Settings saved.</div>
{% endif %}

<form method="POST" action="/settings" class="max-w-xl space-y-6">
    <fieldset class="border border-sand rounded-2xl p-6 bg-white">
        <legend class="text-sm font-bold px-2 text-ink">LLM Backend</legend>
        <label for="llm_backend" class="block mt-3 mb-1 text-xs font-semibold text-stone-500 uppercase tracking-wide">Backend</label>
        <select name="llm_backend" id="llm_backend"
                class="w-full px-3 py-2 text-sm border border-sand rounded-lg bg-page text-ink outline-none transition focus:border-red-400 focus:ring-2 focus:ring-red-100">
            <option value="ollama" {% if settings.llm_backend == 'ollama' %}selected{% endif %}>Ollama (local)</option>
            <option value="claude-api" {% if settings.llm_backend == 'claude-api' %}selected{% endif %}>Claude API</option>
            <option value="openai" {% if settings.llm_backend == 'openai' %}selected{% endif %}>OpenAI</option>
            <option value="llama-cpp" {% if settings.llm_backend == 'llama-cpp' %}selected{% endif %}>llama.cpp</option>
        </select>

        <label for="ollama_model" class="block mt-4 mb-1 text-xs font-semibold text-stone-500 uppercase tracking-wide">Ollama Model</label>
        <input type="text" name="ollama_model" id="ollama_model" value="{{ settings.ollama_model or 'llama3.2' }}" placeholder="llama3.2"
               class="w-full px-3 py-2 text-sm border border-sand rounded-lg bg-page text-ink outline-none transition focus:border-red-400 focus:ring-2 focus:ring-red-100">

        <label for="anthropic_api_key" class="block mt-4 mb-1 text-xs font-semibold text-stone-500 uppercase tracking-wide">Anthropic API Key</label>
        <input type="password" name="anthropic_api_key" id="anthropic_api_key" value="{{ settings.anthropic_api_key or '' }}" placeholder="sk-ant-..."
               class="w-full px-3 py-2 text-sm border border-sand rounded-lg bg-page text-ink outline-none transition focus:border-red-400 focus:ring-2 focus:ring-red-100">

        <label for="openai_api_key" class="block mt-4 mb-1 text-xs font-semibold text-stone-500 uppercase tracking-wide">OpenAI API Key</label>
        <input type="password" name="openai_api_key" id="openai_api_key" value="{{ settings.openai_api_key or '' }}" placeholder="sk-..."
               class="w-full px-3 py-2 text-sm border border-sand rounded-lg bg-page text-ink outline-none transition focus:border-red-400 focus:ring-2 focus:ring-red-100">
    </fieldset>

    <fieldset class="border border-sand rounded-2xl p-6 bg-white">
        <legend class="text-sm font-bold px-2 text-ink">Appearance</legend>
        <label for="theme" class="block mt-3 mb-1 text-xs font-semibold text-stone-500 uppercase tracking-wide">Reader Theme</label>
        <select name="theme" id="theme"
                class="w-full px-3 py-2 text-sm border border-sand rounded-lg bg-page text-ink outline-none transition focus:border-red-400 focus:ring-2 focus:ring-red-100">
            {% for name, desc in themes.items() %}
            <option value="{{ name }}" {% if settings.theme == name %}selected{% endif %}>{{ name }} — {{ desc }}</option>
            {% endfor %}
        </select>
    </fieldset>

    <fieldset class="border border-sand rounded-2xl p-6 bg-white">
        <legend class="text-sm font-bold px-2 text-ink">Kindle / Email</legend>
        <label for="kindle_email" class="block mt-3 mb-1 text-xs font-semibold text-stone-500 uppercase tracking-wide">Kindle Email</label>
        <input type="email" name="kindle_email" id="kindle_email" value="{{ settings.kindle_email or '' }}" placeholder="your-kindle@kindle.com"
               class="w-full px-3 py-2 text-sm border border-sand rounded-lg bg-page text-ink outline-none transition focus:border-red-400 focus:ring-2 focus:ring-red-100">

        <label for="smtp_host" class="block mt-4 mb-1 text-xs font-semibold text-stone-500 uppercase tracking-wide">SMTP Host</label>
        <input type="text" name="smtp_host" id="smtp_host" value="{{ settings.smtp_host or '' }}" placeholder="smtp.gmail.com"
               class="w-full px-3 py-2 text-sm border border-sand rounded-lg bg-page text-ink outline-none transition focus:border-red-400 focus:ring-2 focus:ring-red-100">

        <label for="smtp_port" class="block mt-4 mb-1 text-xs font-semibold text-stone-500 uppercase tracking-wide">SMTP Port</label>
        <input type="number" name="smtp_port" id="smtp_port" value="{{ settings.smtp_port or '587' }}" placeholder="587"
               class="w-full px-3 py-2 text-sm border border-sand rounded-lg bg-page text-ink outline-none transition focus:border-red-400 focus:ring-2 focus:ring-red-100">

        <label for="smtp_user" class="block mt-4 mb-1 text-xs font-semibold text-stone-500 uppercase tracking-wide">SMTP Username</label>
        <input type="text" name="smtp_user" id="smtp_user" value="{{ settings.smtp_user or '' }}" placeholder="user@gmail.com"
               class="w-full px-3 py-2 text-sm border border-sand rounded-lg bg-page text-ink outline-none transition focus:border-red-400 focus:ring-2 focus:ring-red-100">

        <label for="smtp_pass" class="block mt-4 mb-1 text-xs font-semibold text-stone-500 uppercase tracking-wide">SMTP Password</label>
        <input type="password" name="smtp_pass" id="smtp_pass" value="{{ settings.smtp_pass or '' }}" placeholder="app password"
               class="w-full px-3 py-2 text-sm border border-sand rounded-lg bg-page text-ink outline-none transition focus:border-red-400 focus:ring-2 focus:ring-red-100">

        <label for="smtp_from" class="block mt-4 mb-1 text-xs font-semibold text-stone-500 uppercase tracking-wide">From Address</label>
        <input type="email" name="smtp_from" id="smtp_from" value="{{ settings.smtp_from or '' }}" placeholder="readtube@example.com"
               class="w-full px-3 py-2 text-sm border border-sand rounded-lg bg-page text-ink outline-none transition focus:border-red-400 focus:ring-2 focus:ring-red-100">
    </fieldset>

    <fieldset class="border border-sand rounded-2xl p-6 bg-white">
        <legend class="text-sm font-bold px-2 text-ink">Automation</legend>
        <label for="auto_fetch_interval" class="block mt-3 mb-1 text-xs font-semibold text-stone-500 uppercase tracking-wide">Auto-Fetch Interval (minutes, 0 = disabled)</label>
        <input type="number" name="auto_fetch_interval" id="auto_fetch_interval" value="{{ ((settings.auto_fetch_interval or '0') | int / 60) | int }}" min="0" placeholder="0"
               class="w-full px-3 py-2 text-sm border border-sand rounded-lg bg-page text-ink outline-none transition focus:border-red-400 focus:ring-2 focus:ring-red-100">
    </fieldset>

    <button type="submit" class="btn btn-primary">Save Settings</button>
</form>
{% endblock %}
